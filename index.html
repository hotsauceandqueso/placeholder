<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player - Fixed & Working</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:Segoe UI,Tahoma,sans-serif; background:linear-gradient(135deg,#1e1e2e,#2d1b3d); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
.container { display:grid; grid-template-columns:1fr 1fr; gap:30px; max-width:1200px; width:100%; }
.player-card,.search-card { background:rgba(50,40,70,0.7); border-radius:20px; padding:40px; backdrop-filter:blur(10px); box-shadow:0 8px 32px rgba(0,0,0,0.3); }
.album-art { width:100%; aspect-ratio:1; background:linear-gradient(135deg,#667eea,#764ba2); border-radius:15px; margin-bottom:30px; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.album-art img { width:100%; height:100%; object-fit:cover; }
.song-title { color:#fff; font-size:24px; font-weight:600; margin-bottom:5px; }
.artist-name { color:#aaa; font-size:16px; margin-bottom:30px; }
.progress-bar { height:6px; background:rgba(255,255,255,0.2); border-radius:3px; margin-bottom:10px; cursor:pointer; position:relative; }
.progress { height:100%; background:#764ba2; border-radius:3px; width:0%; }
.time-display { display:flex; justify-content:space-between; color:#aaa; font-size:12px; margin-bottom:30px; }
.controls { display:flex; justify-content:center; gap:20px; align-items:center; }
.control-btn { background:none; border:none; color:#fff; cursor:pointer; padding:12px; border-radius:50%; }
.play-btn { width:70px; height:70px; background:#fff; color:#2d1b3d; }
.search-input { flex:1; background:rgba(255,255,255,0.1); border:none; padding:15px 20px; border-radius:25px; color:#fff; outline:none; }
.engine-select { background:rgba(255,255,255,0.1); border:none; padding:10px 15px; border-radius:15px; color:#fff; }
.search-btn { background:#764ba2; border:none; padding:15px 30px; border-radius:25px; color:#fff; cursor:pointer; }
.search-results { max-height:500px; overflow-y:auto; margin-top:20px; }
.song-item { background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:10px; cursor:pointer; display:flex; gap:15px; }
.song-item:hover { background:rgba(255,255,255,0.1); }
.song-thumbnail { width:60px; height:60px; background:#764ba2; border-radius:8px; overflow:hidden; flex-shrink:0; }
.song-thumbnail img { width:100%; height:100%; object-fit:cover; }
.loading,.error { text-align:center; padding:30px; color:#aaa; }
.error { color:#ff6b6b; }
@media (max-width:768px) { .container { grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="container">
  <div class="player-card">
    <div class="album-art" id="albumArt"><img id="artImg" src="" style="display:none"></div>
    <div class="song-title" id="currentSong">Search for music</div>
    <div class="artist-name" id="currentArtist">Find your favorite tracks</div>
    <div class="progress-bar" id="progressBar"><div class="progress" id="progress"></div></div>
    <div class="time-display"><span id="currentTime">0:00</span><span id="duration">0:00</span></div>
    <div class="controls">
      <button class="control-btn play-btn" onclick="togglePlay()" id="playBtn">▶</button>
    </div>
  </div>

  <div class="search-card">
    <div style="display:flex; gap:10px; align-items:center;">
      <input type="text" class="search-input" id="searchInput" placeholder="Search any song">
      <select class="engine-select" id="engineSelect">
        <option value="gaama">Gaama</option>
        <option value="seevn">Seevn</option>
        <option value="hunjama">Hunjama</option>
        <option value="mtmusic">MTMusic</option>
        <option value="wunk">Wunk</option>
      </select>
      <button class="search-btn" onclick="searchMusic()">Search</button>
    </div>
    <div class="search-results" id="searchResults">
      <div style="text-align:center; color:#aaa; padding:40px;">Enter a song name and click Search</div>
    </div>
  </div>
</div>

<audio id="audioPlayer"></audio>

<script>
// Fixed CORS proxy that actually works (2025)
const PROXY = 'https://api.allorigins.win/raw?url=';
const API = 'https://musicapi.x007.workers.dev';

const audio = document.getElementById('audioPlayer');
let currentResults = [];

document.getElementById('searchInput').addEventListener('keypress', e => e.key==='Enter' && searchMusic());

async function searchMusic() {
  const query = document.getElementById('searchInput').value.trim();
  const engine = document.getElementById('engineSelect').value;
  if (!query) return alert('Enter a song name');

  const resultsDiv = document.getElementById('searchResults');
  resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

  try {
    const url = `${PROXY}${encodeURIComponent(`${API}/search?q=${encodeURIComponent(query)}&searchEngine=${engine}`)}`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.status === 200 && data.response?.length > 0) {
      currentResults = data.response;
      displayResults(data.response);
    } else {
      resultsDiv.innerHTML = '<div class="error">No results found. Try another engine.</div>';
    }
  } catch (err) {
    resultsDiv.innerHTML = '<div class="error">Search failed. Try again.</div>';
    console.error(err);
  }
}

function displayResults(tracks) {
  const div = document.getElementById('searchResults');
  div.innerHTML = '';
  tracks.forEach((track, i) => {
    const item = document.createElement('div');
    item.className = 'song-item';
    item.onclick = () => playSong(track, i);
    item.innerHTML = `
      <div class="song-thumbnail"><img src="${track.img || ''}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGQ9Ik0xMiAzdjEwLjU1Yy0uNTktLjM0LTEuMjctLjU1LTItLjU1LTIuMjEgMC00IDEuNzktNCA0czEuNzkgNCA0IDRzNC0xLjc5IDQtNFY3aDRWM2gtNnoiIGZpbGw9IiM3NjRiYTIiLz48L3N2Zz4='"></div>
      <div class="song-info">
        <div class="song-name">${track.title || 'Unknown'}</div>
        <div class="song-artist">${track.artist || 'Unknown'}</div>
      </div>
    `;
    div.appendChild(item);
  });
}

async function playSong(track, index) {
  document.getElementById('searchResults').innerHTML = '<div class="loading">Loading song...</div>';

  try {
    const url = `${PROXY}${encodeURIComponent(`${API}/fetch?id=${track.id}`)}`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.status === 200 && data.response) {
      document.getElementById('currentSong').textContent = track.title || 'Unknown';
      document.getElementById('currentArtist').textContent = track.artist || '';
      if (track.img) {
        document.getElementById('artImg').src = track.img;
        document.getElementById('artImg').style.display = 'block';
      }
      audio.src = data.response;
      audio.play();
      document.getElementById('playBtn').textContent = '❚❚';
    } else {
      throw new Error();
    }
  } catch (e) {
    alert('Failed to load this song. Try another one.');
  }
  searchMusic(); // restore results
}

function togglePlay() {
  if (audio.paused) {
    audio.play();
    document.getElementById('playBtn').textContent = '❚❚';
  } else {
    audio.pause();
    document.getElementById('playBtn').textContent = '▶';
  }
}

audio.addEventListener('timeupdate', () => {
  if (audio.duration) {
    const percent = (audio.currentTime / audio.duration) * 100;
    document.getElementById('progress').style.width = percent + '%';
    document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
    document.getElementById('duration').textContent = formatTime(audio.duration);
  }
});

function formatTime(s) {
  if (!s) return '0:00';
  const m = Math.floor(s/60);
  const sec = Math.floor(s%60);
  return `${m}:${sec.toString().padStart(2,'0')}`;
}
</script>
</body>
</html>
